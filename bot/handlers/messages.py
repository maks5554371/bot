from aiogram import Router, F
from aiogram.types import Message

from services.api import api_post

router = Router()


@router.message(F.text & ~F.text.startswith('/'))
async def handle_text_message(message: Message):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞."""
    text = message.text

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ¬ª
    if text == "üì∏ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ":
        await message.answer(
            "üì∏ –ü—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –≤ —ç—Ç–æ—Ç —á–∞—Ç –∏ —è –ø–µ—Ä–µ–¥–∞–º –µ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É!",
        )
        return

    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ ¬´–ú–æ–π —Å—Ç–∞—Ç—É—Å¬ª
    if text == "‚ÑπÔ∏è –ú–æ–π —Å—Ç–∞—Ç—É—Å":
        await message.answer(
            "üìä –¢–≤–æ–π —Å—Ç–∞—Ç—É—Å: <i>–æ–∂–∏–¥–∞–π –ø–æ–¥—Å–∫–∞–∑–∫—É –æ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</i>\n\n"
            "–ï—Å–ª–∏ —Ç–µ–±—è —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –∫–æ–º–∞–Ω–¥—É ‚Äî —Å–∫–æ—Ä–æ –ø—Ä–∏–¥—ë—Ç –ø–µ—Ä–≤–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞!",
            parse_mode='HTML',
        )
        return

    # –ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É
    result = await api_post('message', {
        'telegram_id': message.from_user.id,
        'text': text,
    })

    if 'error' not in result:
        await message.answer("üì® –°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É!")
    else:
        await message.answer("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.")
